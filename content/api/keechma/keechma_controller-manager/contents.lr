_model: api-annotated
---
title: API / keechma.controller-manager documentation
---
body:

<div class="api-container">
    
    <div class="sidebar primary">
        <h3 class="no-link"><span class="inner">Project</span></h3>
        <ul class="index-link">
            <li class="depth-1 ">
                <a href="/api/keechma/">
                    <div class="inner">Index</div>
                </a>
            </li>
        </ul>
        <h3 class="no-link"><span class="inner">Namespaces</span></h3>
        <ul>
            <li class="depth-1">
                <div class="no-link">
                    <div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>keechma</span></div>
                </div>
            </li>
            <li class="depth-2 branch">
                <a href="/api/keechma/keechma_app-state">
                    <div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>app-state</span></div>
                </a>
            </li>
            <li class="depth-2 branch">
                <a href="/api/keechma/keechma_controller">
                    <div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>controller</span></div>
                </a>
            </li>
            <li class="depth-2 branch current">
                <a href="/api/keechma/keechma_controller-manager">
                    <div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>controller-manager</span></div>
                </a>
            </li>
            <li class="depth-2">
                <a href="/api/keechma/keechma_ui-component">
                    <div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ui-component</span></div>
                </a>
            </li>
        </ul>
    </div>
    <div class="sidebar secondary">
        <h3><a href="#top"><span class="inner">Public Vars</span></a></h3>
        <ul>
            <li class="depth-1">
                <a href="#var-apply-route-change">
                    <div class="inner"><span>apply-route-change</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-apply-start-controllers">
                    <div class="inner"><span>apply-start-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-apply-start-or-wake-controllers">
                    <div class="inner"><span>apply-start-or-wake-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-apply-stop-controllers">
                    <div class="inner"><span>apply-stop-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-apply-wake-controllers">
                    <div class="inner"><span>apply-wake-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-call-handler-on-started-controllers">
                    <div class="inner"><span>call-handler-on-started-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-call-ssr-handler-on-started-controllers">
                    <div class="inner"><span>call-ssr-handler-on-started-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-report-running-controllers">
                    <div class="inner"><span>report-running-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-route-change-execution-plan">
                    <div class="inner"><span>route-change-execution-plan</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-send-route-changed-to-surviving-controllers">
                    <div class="inner"><span>send-route-changed-to-surviving-controllers</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-start">
                    <div class="inner"><span>start</span></div>
                </a>
            </li>
            <li class="depth-1">
                <a href="#var-start-ssr">
                    <div class="inner"><span>start-ssr</span></div>
                </a>
            </li>
        </ul>
    </div>
    <div class="namespace-docs" id="content">
        <h1 class="anchor" id="top">keechma.controller-manager</h1>
        <div class="doc">
            <div class="markdown"></div>
        </div>
        <div class="public anchor" id="var-apply-route-change">
            <h3>apply-route-change</h3>
            <div class="usage"><code>(apply-route-change reporter route-params app-db-atom commands-chan controllers)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-apply-start-controllers">
            <h3>apply-start-controllers</h3>
            <div class="usage"></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-apply-start-or-wake-controllers">
            <h3>apply-start-or-wake-controllers</h3>
            <div class="usage"><code>(apply-start-or-wake-controllers action reporter-action app-db reporter controllers commands-chan get-running start-or-wake)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-apply-stop-controllers">
            <h3>apply-stop-controllers</h3>
            <div class="usage"><code>(apply-stop-controllers app-db reporter stop)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-apply-wake-controllers">
            <h3>apply-wake-controllers</h3>
            <div class="usage"></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-call-handler-on-started-controllers">
            <h3>call-handler-on-started-controllers</h3>
            <div class="usage"><code>(call-handler-on-started-controllers app-db-atom reporter start)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-call-ssr-handler-on-started-controllers">
            <h3>call-ssr-handler-on-started-controllers</h3>
            <div class="usage"><code>(call-ssr-handler-on-started-controllers app-db-atom reporter start ssr-handler-done-cb)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-report-running-controllers">
            <h3>report-running-controllers</h3>
            <div class="usage"><code>(report-running-controllers app-db-atom)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-route-change-execution-plan">
            <h3>route-change-execution-plan</h3>
            <div class="usage"><code>(route-change-execution-plan route-params running-controllers controllers)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-send-route-changed-to-surviving-controllers">
            <h3>send-route-changed-to-surviving-controllers</h3>
            <div class="usage"><code>(send-route-changed-to-surviving-controllers app-db-atom reporter route-changed route-params)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
        <div class="public anchor" id="var-start">
            <h3>start</h3>
            <div class="usage"><code>(start route-chan route-processor commands-chan app-db-atom controllers reporter)</code></div>
            <div class="doc">
                <div class="markdown">
                    <p>Starts the controller manager. Controller manager is the central part of the application that manages the lifecycle of the controllers and routes the messages sent to them.</p>
                    <p><code>start</code> function receives the following parameters:</p>
                    <ul>
                        <li><code>route-chan</code> - Route changes will communicated through this channel</li>
                        <li><code>route-processor</code> - Function that will be called on every route change. It can be used to process the route before it&#x2019;s written into app-db</li>
                        <li><code>commands-chan</code> - User (UI) commands will be sent through this channel</li>
                        <li><code>app-db</code> - application state atom</li>
                        <li><code>controllers</code> map of controllers registered for the app</li>
                        <li><code>reporter</code> - internal reporter function</li>
                    </ul>
                    <p>Each time when the new route data comes through the <code>route-chan</code> controller manager will do the following:</p>
                    <ul>
                        <li>call the <code>params</code> function on each registered controller</li>
                        <li>compare the value returned by the <code>params</code> function with the value that was returned last time when the route changes</li>
                        <li>based on the comparison it will do one of the following:</li>
                        <li>if the last value was <code>nil</code> and the current value is <code>nil</code> - do nothing</li>
                        <li>if the last value was <code>nil</code> and the current value is not <code>nil</code> - start the controller</li>
                        <li>if the last value was not <code>nil</code> and the current value is <code>nil</code> - stop the controller</li>
                        <li>if the last value was not <code>nil</code> and the current value is not <code>nil</code> and these values are the same - do nothing</li>
                        <li>if the last value was not <code>nil</code> and the current value is not <code>nil</code> and these values are different - restart the controller (stop the current instance and start the new one)</li>
                    </ul>
                    <p>Controller manager also acts as a command router. Each time a command comes - through the <code>commands-chan</code> the name of the command should look like this <code>[:controlnler-key :command-name]</code>. Controller manager will
                        route the <code>:command-name</code> command to the appropriate controller based on the <code>:controller-key</code>. Controller key is the key under which the controller was registered in the <code>controllers</code> argument.</p>
                </div>
            </div>
        </div>
        <div class="public anchor" id="var-start-ssr">
            <h3>start-ssr</h3>
            <div class="usage"><code>(start-ssr routes-chan commands-chan app-db-atom controllers reporter done-cb)</code></div>
            <div class="doc">
                <div class="markdown"></div>
            </div>
        </div>
    </div>
</div>